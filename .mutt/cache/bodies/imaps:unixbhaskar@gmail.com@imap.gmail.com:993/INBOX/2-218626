Delivered-To: unixbhaskar@gmail.com
Received: by 2002:a19:7015:0:0:0:0:0 with SMTP id h21csp6873411lfc;
        Wed, 15 Jan 2020 05:59:52 -0800 (PST)
X-Google-Smtp-Source: APXvYqxRCzLY3G3safTRY2mAigXyDVGflRg+nEqfPdfApV7ozfEpQvBsbFaSSl12LxWaoJ+fOWG8
X-Received: by 2002:a9d:2c68:: with SMTP id f95mr2813022otb.33.1579096792106;
        Wed, 15 Jan 2020 05:59:52 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1579096792; cv=none;
        d=google.com; s=arc-20160816;
        b=dF/x6jbkLPT/lJyfpZOidsIq+1Iv4vHuthlC+vfVh+M8en5MCvo3FhcKMe7exhXf7O
         NEJ9+qr+u+ITJHQ9Gh6G0Jg//gVwVxo+h0hlXCYsS+fKbpKNzdAg64NFut0XM1nAvgAb
         SCWQ3RHDVbWXPs+Up6bSzIBXcFkfPoBvXQppxKJWRtBcs+UvMiQl6z0joDWFh3nkhcuu
         aDj4QjSdeE3Vt1tUdmT1K8Nx2KYnAAnVQLpApnfPasYqFfd90B7zaK7kUUAtcsHKLuMl
         45/D/gRRNxL2miB2EkHdVx3c50Afyv7SO+2V9YLhVlJdtrTrvfLjako9+wRc4SFlrGh3
         FYGw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=list-id:precedence:sender:in-reply-to:content-transfer-encoding
         :content-disposition:mime-version:references:message-id:subject:cc
         :to:from:date;
        bh=l24YWhgsjrbe65czcMdU95KMqUliyFyrUcwfyQ0ok/Y=;
        b=v1r3pbEgoRzbNV6XyCfv3FbD5bngctSkyB/7fBrhnXHvRnD5A9uwJzWjRlj2FiTYdg
         bBD31ohDOXQCRCDCvpSVNP1ep4kmVxQZgvxXTwa/foW4wWzhR5kR4x1vVspHmyd/mZqb
         KfToDNvqQ8R0Xu6gq5vG4tXr6IlIbcSST5dYjx0tuxBMCfXf1eNzpog3X+mmhHjuXrIW
         kFkhoNiFBF4B5bhbZZx+vrn0doBExBxU2PxdWZPoNhCrJves516JoMHJfXFekaGQceL5
         zWKSjk35Pf9eM56jAzqSpRCRF2o95h5CyRXgRBAgdf886Jq+U7sr2G72O8z72z0jVP5W
         NaAw==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of linux-kernel-owner@vger.kernel.org designates 209.132.180.67 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: from vger.kernel.org (vger.kernel.org. [209.132.180.67])
        by mx.google.com with ESMTP id t1si9323582oic.140.2020.01.15.05.59.40;
        Wed, 15 Jan 2020 05:59:52 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of linux-kernel-owner@vger.kernel.org designates 209.132.180.67 as permitted sender) client-ip=209.132.180.67;
Authentication-Results: mx.google.com;
       spf=pass (google.com: best guess record for domain of linux-kernel-owner@vger.kernel.org designates 209.132.180.67 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1730028AbgAON7L (ORCPT <rfc822;huszaghmatt@gmail.com>
        + 99 others); Wed, 15 Jan 2020 08:59:11 -0500
Received: from zeniv.linux.org.uk ([195.92.253.2]:57118 "EHLO
        ZenIV.linux.org.uk" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1729887AbgAONz3 (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Wed, 15 Jan 2020 08:55:29 -0500
Received: from viro by ZenIV.linux.org.uk with local (Exim 4.92.3 #3 (Red Hat Linux))
        id 1irj8p-008oCW-0s; Wed, 15 Jan 2020 13:55:27 +0000
Date:   Wed, 15 Jan 2020 13:55:27 +0000
From:   Al Viro <viro@zeniv.linux.org.uk>
To:     Laurent Vivier <laurent@vivier.eu>
Cc:     linux-kernel@vger.kernel.org, linux-fsdevel@vger.kernel.org,
        James Bottomley <James.Bottomley@hansenpartnership.com>
Subject: Re: [RFC v2] binfmt_misc: pass binfmt_misc flags to the interpreter
Message-ID: <20200115135527.GG8904@ZenIV.linux.org.uk>
References: <20191122150830.15855-1-laurent@vivier.eu>
 <b39e59a6-82f2-2122-5b22-4d8a77eda275@vivier.eu>
 <2a464b33-0b1d-ff35-5aab-77019a072593@vivier.eu>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <2a464b33-0b1d-ff35-5aab-77019a072593@vivier.eu>
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, Jan 15, 2020 at 01:19:16PM +0100, Laurent Vivier wrote:
> Le 07/01/2020 à 15:50, Laurent Vivier a écrit :
> > Hi,
> > 
> > this change is simple, easy to read and understand but it is really
> > needed by user space application interpreter to know the status of the
> > system configuration.
> > 
> > Could we have a comment saying if there is a problem or if it is good to
> > be merged?
> 
> Anyone?

	FWIW, one thing that looks worrying here is that these bits become
userland ABI after this patch - specific values passed in that thing
can't be changed.  And no a single mention of that in fs/binfmt_misc.c,
leaving a nasty trap.  As far as one can tell, their values are fair game
for reordering, etc. - not even visible outside of fs/binfmt_misc.c;
purely internal constants.  And the effect of such modifications after
your patch will not be "everything breaks, patch gets caught by somebody's
tests" - it will be a quiet breakage for some users.

> >>  #define MISC_FMT_OPEN_BINARY (1 << 30)
> >>  #define MISC_FMT_CREDENTIALS (1 << 29)
> >>  #define MISC_FMT_OPEN_FILE (1 << 28)
> >> +#define MISC_FMT_FLAGS_MASK (MISC_FMT_PRESERVE_ARGV0 | MISC_FMT_OPEN_BINARY | \
> >> +			     MISC_FMT_CREDENTIALS | MISC_FMT_OPEN_FILE)

IOW, you are making those parts of userland ABI cast in stone forever.
Whether this bit assignment does make sense or not, such things really
should not be hidden.
