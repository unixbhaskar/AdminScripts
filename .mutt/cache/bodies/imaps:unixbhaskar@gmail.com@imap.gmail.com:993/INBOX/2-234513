Delivered-To: unixbhaskar@gmail.com
Received: by 2002:a05:6512:1086:0:0:0:0 with SMTP id j6csp743647lfg;
        Fri, 17 Apr 2020 10:43:38 -0700 (PDT)
X-Google-Smtp-Source: APiQypLmg4wHWUVihfifkUZL9bTk6ZzyzMBcNxzGuISc5XocaZx1W8HfBvTyJ/8qot2H3hhgudhK
X-Received: by 2002:a17:906:4907:: with SMTP id b7mr3861373ejq.279.1587145418057;
        Fri, 17 Apr 2020 10:43:38 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1587145418; cv=none;
        d=google.com; s=arc-20160816;
        b=Gzrf05Y1n8S2kC4TJda5MRXtwNZ/NM/Wi9f9Th378lkKfAqn5EndhViHtSylR8aF4x
         ey1UBOF/js+vYKTxiKpcNbgjiJGHC+UJpiEEvTEVMNRWNKBQJrMfVfqKbzOGl8NrS9ge
         hjKqDkgCAN5ujS0yFdSy3RHB6MjzEwsXdS+dXqE2nx/amHosDHIhC9ABCdm5dkbnKXJB
         HAFimv41tLB76ozg1jHYR1efgLgJ0CUSh+6KPDuAPNqaLMx4Uxs95Oi37nkeAWk1KpJ7
         VvNq89PixLQlq3TrtGZMoIOrjKGwlFba4zOOObDiNikCnYgn1QCNy9qFBJqVZjfFqfEg
         K0Cw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=list-id:precedence:sender:content-transfer-encoding
         :content-language:in-reply-to:mime-version:user-agent:date
         :message-id:from:references:cc:to:subject:dkim-signature;
        bh=KjrOit2pYvG6gEqrAeDYI3gE0UdgfpjpULdnfz35SG4=;
        b=FRrtfHNA9ugDe83CVm5BMZngG34Nn2fysL4FFpNZ2vVigfkBPRR6/c+C3FK/1Eu5NV
         TK/0787MULKdTVP60P2iLoQL8S1RU1fF4H2NXw224a91RXSfVUyLj2v9XGVJG79XrU6p
         7CoTSgZji6iOx796gcvHgaG0C0KETsA0DrM09fvC5IvUilmohbJiQ8uMhzrmWmDSooAX
         hZMe2A0iaqX2bG3zUbDU3jmvevCOJhySMlQSt9ZSbDEwW0QAOGmrBAKJaZpDu0lc9GBo
         ERWjYAFFBQ/gYtV8gsCQLIQ+EwfXfcJzVN7VLLMloiyMEbAP9MJugseqdnxH690TC68P
         KQIg==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass header.i=@kernel-dk.20150623.gappssmtp.com header.s=20150623 header.b=hfCzRr7n;
       spf=pass (google.com: domain of linux-kernel-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: from vger.kernel.org (vger.kernel.org. [23.128.96.18])
        by mx.google.com with ESMTP id n20si6915327ejr.443.2020.04.17.10.43.12;
        Fri, 17 Apr 2020 10:43:38 -0700 (PDT)
Received-SPF: pass (google.com: domain of linux-kernel-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) client-ip=23.128.96.18;
Authentication-Results: mx.google.com;
       dkim=pass header.i=@kernel-dk.20150623.gappssmtp.com header.s=20150623 header.b=hfCzRr7n;
       spf=pass (google.com: domain of linux-kernel-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1730141AbgDQRme (ORCPT <rfc822;guilhem.herail@gmail.com>
        + 99 others); Fri, 17 Apr 2020 13:42:34 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:37118 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-FAIL-OK-FAIL)
        by vger.kernel.org with ESMTP id S1730098AbgDQRmd (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 17 Apr 2020 13:42:33 -0400
Received: from mail-pj1-x1044.google.com (mail-pj1-x1044.google.com [IPv6:2607:f8b0:4864:20::1044])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 58C6AC061A0F
        for <linux-kernel@vger.kernel.org>; Fri, 17 Apr 2020 10:42:33 -0700 (PDT)
Received: by mail-pj1-x1044.google.com with SMTP id 7so2396821pjo.0
        for <linux-kernel@vger.kernel.org>; Fri, 17 Apr 2020 10:42:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=kernel-dk.20150623.gappssmtp.com; s=20150623;
        h=subject:to:cc:references:from:message-id:date:user-agent
         :mime-version:in-reply-to:content-language:content-transfer-encoding;
        bh=KjrOit2pYvG6gEqrAeDYI3gE0UdgfpjpULdnfz35SG4=;
        b=hfCzRr7n9mEYTAzBtGsqWPrXejcBdO5Qow4g1jcQych3gq3xMjtal1xwI1r0Xaltxg
         yOtWdQuQor/DxpjYesdIWV0ZJ0OS84Rbas3R5Jo6sGHlqZV8IucD609aVErkzYTaozDW
         iZRPrR2VgmL6QzTT68OtXYFHagWH+Xrq2cJ5T7LGCn65ywk8bJGveZF5ugT8ycyWpad1
         gzB9YmagGJgST/YiEpY5nw9TpSElJVBxpla1je6WnVaA7RC1tTXPHwHEln0rgGic2siW
         kGIgF6hQ1pWO7t16HoW4SP7IVKGatWHYZkn70aDNcWTBQp3kJ1rLWPQRorrfjanJEROC
         ZAaA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:subject:to:cc:references:from:message-id:date
         :user-agent:mime-version:in-reply-to:content-language
         :content-transfer-encoding;
        bh=KjrOit2pYvG6gEqrAeDYI3gE0UdgfpjpULdnfz35SG4=;
        b=JbcxdJN0P/n/orfp92IIN52YvDeSbOlOg/l9udMAVFy5KDyQWYyTwevEDHEoB6eAR1
         CpK3/W1jdYPOeIsL1DSVEG1j+Ep4mVuloPedcKU+PkhlMDueBBLEct82gRpuE13PrPxt
         MyxnXsg9KDd3FVSSaFLm73CPYHPoKiL7zKIQa/Y+UMrK+2g9dHPiacGAKd8iZ/orD8+y
         QjOv2yxo+HFGKBycbK+9/8yJGl5vhwQco5wN5CsuOaScJJS7V/tnkFZF+BYGxhKhR6da
         gwl0Qd3a2CwC1hcz8r3kMIi3P8DQ81sF45pT1E5HvIspZanGj+IAR0Sjs4P7MI8EIjz+
         pXNQ==
X-Gm-Message-State: AGi0Pua2PlfRBAs2O1TFbXCmn4NSG0KR9wcMfP6J7Dcm2ts+NM5cfyCt
        Hsbh4jz5wWrusqLli53nVPgLLg==
X-Received: by 2002:a17:90a:364c:: with SMTP id s70mr5685521pjb.143.1587145352627;
        Fri, 17 Apr 2020 10:42:32 -0700 (PDT)
Received: from [192.168.1.188] ([66.219.217.145])
        by smtp.gmail.com with ESMTPSA id h15sm13021131pgj.35.2020.04.17.10.42.30
        (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
        Fri, 17 Apr 2020 10:42:31 -0700 (PDT)
Subject: Re: [GIT PULL] io_uring fixes for 5.7-rc
To:     Linus Torvalds <torvalds@linux-foundation.org>
Cc:     "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
        io-uring <io-uring@vger.kernel.org>
References: <2750fd4f-8edc-18c2-1991-c1dc794a431f@kernel.dk>
 <CAHk-=wiWP0M=ZAim7VVuoR+5ri+Ug+KZDE-TZskma4HV91ACxA@mail.gmail.com>
From:   Jens Axboe <axboe@kernel.dk>
Message-ID: <53ee39ac-2d97-9bcc-80c9-5ed9b0868e8f@kernel.dk>
Date:   Fri, 17 Apr 2020 11:42:29 -0600
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.7.0
MIME-Version: 1.0
In-Reply-To: <CAHk-=wiWP0M=ZAim7VVuoR+5ri+Ug+KZDE-TZskma4HV91ACxA@mail.gmail.com>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On 4/17/20 11:26 AM, Linus Torvalds wrote:
> On Fri, Apr 17, 2020 at 8:16 AM Jens Axboe <axboe@kernel.dk> wrote:
>>
>> - Work restore poll cancelation fix
> 
> That whole apoll thing is disgusting.
> 
> I cannot convince myself it is right. How do you convince yourself?

req->poll is used for pure poll requests, req->apoll is used for poll
that is armed on behalf of a non-poll request. So the paths are actually
pretty well defined, for both the submission side entry, and the
completion side which is through the wakeup handlers.

The handlers that deal with the "poll on behalf of another request" is
pretty short and limited. Anything that uses "poll on behalf of others"
is not going to be queued async, which is the overlap with io_wq_work
in the io_kiocb structure. The only part we have to be a bit careful
with there is for the assume contexts, like mm etc. One of the fixes
in this pull request deals with that.

-- 
Jens Axboe

