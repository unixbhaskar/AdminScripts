Delivered-To: unixbhaskar@gmail.com
Received: by 2002:a19:f20e:0:0:0:0:0 with SMTP id q14csp951207lfh;
        Wed, 13 May 2020 21:47:09 -0700 (PDT)
X-Google-Smtp-Source: APiQypK4zSt3EEE0CSe4QZ5oAA+rcG98GgkN5Q1GlDoeCIkR+7omPmaoptLqQSOYBJ8FxJTyrlAy
X-Received: by 2002:a1c:3d08:: with SMTP id k8mr36484127wma.16.1589431629002;
        Wed, 13 May 2020 21:47:09 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1589431628; cv=none;
        d=google.com; s=arc-20160816;
        b=bgAICP9wtUP7nbOqFd6szondRVaWlAZK1ulOmkhLhFTDMCxC1/dbubSqOX2b6JWV4u
         UKY5mCo1hdk5MmfOY6WSVLjPnQUd0pIlluftJl9lA3DT8mzbO2mtgXel9eFpUwYoLzAb
         yPSVtsfYQQurEwkY5T0CBDXWLq90ESUFA/GgkMLoM3JDefsdr1GEp405v5yBb0uV60ox
         iF7+RhnZ29fstBI6Cf4cC6hMk+u4emwBkTCrQijb8HzulnPNZNufgxa6yncCOAUSsuz6
         myPDzRzOc/b/8N8CJWYkLrUF6vTXqQAgXA/MC6PZQY0JRBzldoZObOOIdCqbgqidTnQB
         lrVw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=list-id:precedence:sender:cc:to:subject:message-id:date:from
         :in-reply-to:references:mime-version:dkim-signature;
        bh=DaQQO5QtzR3AitpCVbQh44PeSN/Bjr5pvNcGlW8Lm4E=;
        b=mWG0QhpdNsDpFKAhTiaP+XrQlM4rFrvDYhb8X5VteWlUt8NQZZgcKdvB72JPcNt2a9
         inkTXzG6kYXAgprW/JFVdh1tjI4r2GK3hUVgYdDEqgLyEDSVU5+a2PsEwu8dfHgQRXwW
         lGmv4RBfxXKDUeKP+20vFXrkBja04vUWP22bu5c9T4vdkcTGxY+H1NnPdrw8HiV6xW8P
         lVQQA6zgWk7pLcTusdcuFbHRucr7EiAVfO4yYJMG6bTttkLYouodlmjM/5K+zjlYCpWx
         ppetWoH+LVJLKBYEWbHkho0wx2/RhL9rK8ijLcnOyaeBaiJxpXt6QGCbpk++bHyV1ioB
         M4mw==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass header.i=@zx2c4.com header.s=mail header.b=aXHhlQhK;
       spf=pass (google.com: domain of linux-next-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) smtp.mailfrom=linux-next-owner@vger.kernel.org;
       dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=zx2c4.com
Return-Path: <linux-next-owner@vger.kernel.org>
Received: from vger.kernel.org (vger.kernel.org. [23.128.96.18])
        by mx.google.com with ESMTP id i18si1192633ejk.81.2020.05.13.21.46.41;
        Wed, 13 May 2020 21:47:08 -0700 (PDT)
Received-SPF: pass (google.com: domain of linux-next-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) client-ip=23.128.96.18;
Authentication-Results: mx.google.com;
       dkim=pass header.i=@zx2c4.com header.s=mail header.b=aXHhlQhK;
       spf=pass (google.com: domain of linux-next-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) smtp.mailfrom=linux-next-owner@vger.kernel.org;
       dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=zx2c4.com
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725806AbgENEq1 (ORCPT <rfc822;chandanrlinux@gmail.com>
        + 99 others); Thu, 14 May 2020 00:46:27 -0400
Received: from mail.zx2c4.com ([192.95.5.64]:49915 "EHLO mail.zx2c4.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725794AbgENEq1 (ORCPT <rfc822;linux-next@vger.kernel.org>);
        Thu, 14 May 2020 00:46:27 -0400
Received: by mail.zx2c4.com (ZX2C4 Mail Server) with ESMTP id df5ef381;
        Thu, 14 May 2020 04:32:44 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha1; c=relaxed; d=zx2c4.com; h=mime-version
        :references:in-reply-to:from:date:message-id:subject:to:cc
        :content-type; s=mail; bh=PE/H4CXhRSEB5FLtI6sjan2fvtw=; b=aXHhlQ
        hKJtBkhKRi3+NVcJxy56rF0b2tvMKYtpoztaGUxEhvLh3uqZCszusTiI7hLd3C4Y
        Xza9ft3Y3Wgt/fYO5JucAJiTgt7iBx0syh079sv5piCKPOc9galz4NGbWDDfWGCG
        li1WiYLrp3bONFwZxulPGGLJUy2mjhE5f7TyrAdVnMfQzJGinMdNQ3LYrmLrihfu
        uC3DNwUonXxsrn/lMravOitp8Ho5Lt+COJ7smOiocU2FlxT9v8wM736UusYSxwWJ
        CIrDxUpb9qwqP4YEc3zo7sj3MHFqc1+oEGk9C9+Zx/w2Qs/8Ftf5YQkFwYF7NTCJ
        7uIqY3aQiBq0o/Ew==
Received: by mail.zx2c4.com (ZX2C4 Mail Server) with ESMTPSA id 8dda2136 (TLSv1.3:TLS_AES_256_GCM_SHA384:256:NO);
        Thu, 14 May 2020 04:32:43 +0000 (UTC)
Received: by mail-io1-f44.google.com with SMTP id w11so1554310iov.8;
        Wed, 13 May 2020 21:46:23 -0700 (PDT)
X-Gm-Message-State: AOAM531h6slkEd0yszYrbH19bj1gaQ/d0LTt1pvW2M4fdkzW61CCFSXd
        MaO87JaOJQzvoZWHNB8niAewyN4OXqKforZSmJI=
X-Received: by 2002:a6b:b486:: with SMTP id d128mr2406785iof.79.1589431582612;
 Wed, 13 May 2020 21:46:22 -0700 (PDT)
MIME-Version: 1.0
References: <20200514143055.1f71ba68@canb.auug.org.au>
In-Reply-To: <20200514143055.1f71ba68@canb.auug.org.au>
From:   "Jason A. Donenfeld" <Jason@zx2c4.com>
Date:   Wed, 13 May 2020 22:46:10 -0600
X-Gmail-Original-Message-ID: <CAHmME9osYhwzFEyGUELqSSNexgK56NJrOrWTi3vnyDft8tv-hw@mail.gmail.com>
Message-ID: <CAHmME9osYhwzFEyGUELqSSNexgK56NJrOrWTi3vnyDft8tv-hw@mail.gmail.com>
Subject: Re: linux-next: build failure after merge of the keys tree
To:     Stephen Rothwell <sfr@canb.auug.org.au>,
        Masahiro Yamada <yamada.masahiro@socionext.com>
Cc:     David Howells <dhowells@redhat.com>,
        Linux Next Mailing List <linux-next@vger.kernel.org>,
        Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Content-Type: text/plain; charset="UTF-8"
Sender: linux-next-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-next.vger.kernel.org>
X-Mailing-List: linux-next@vger.kernel.org

Hey Masahiro,

Your touch might be helpful here. CRYPTO_LIB_CHACHA20POLY1305 is a
tristate and depends on as well as selects other things that are
tristates.

Meanwhile BIG_KEYS is a bool, which needs to select
CRYPTO_LIB_CHACHA20POLY1305. However, it gets antsy if the the symbol
its selecting has =m items in its hierarchy.

Any suggestions? The ideal thing to happen would be that the select of
CRYPTO_LIB_CHACHA20POLY1305 in BIG_KEYS causes all of the descendants
to become =y too.

Jason


On Wed, May 13, 2020 at 10:31 PM Stephen Rothwell <sfr@canb.auug.org.au> wrote:
>
> Hi all,
>
> After merging the keys tree, today's linux-next build (x86_64
> allmodconfig) failed like this:
>
> WARNING: unmet direct dependencies detected for CRYPTO_LIB_CHACHA20POLY1305
>   Depends on [m]: CRYPTO [=y] && (CRYPTO_ARCH_HAVE_LIB_CHACHA [=m] || !CRYPTO_ARCH_HAVE_LIB_CHACHA [=m]) && (CRYPTO_ARCH_HAVE_LIB_POLY1305 [=m] || !CRYPTO_ARCH_HAVE_LIB_POLY1305 [=m])
>   Selected by [y]:
>   - BIG_KEYS [=y] && KEYS [=y] && TMPFS [=y]
>   Selected by [m]:
>   - WIREGUARD [=m] && NETDEVICES [=y] && NET_CORE [=y] && NET [=y] && INET [=y] && (IPV6 [=y] || !IPV6 [=y])
>
> WARNING: unmet direct dependencies detected for CRYPTO_LIB_CHACHA20POLY1305
>   Depends on [m]: CRYPTO [=y] && (CRYPTO_ARCH_HAVE_LIB_CHACHA [=m] || !CRYPTO_ARCH_HAVE_LIB_CHACHA [=m]) && (CRYPTO_ARCH_HAVE_LIB_POLY1305 [=m] || !CRYPTO_ARCH_HAVE_LIB_POLY1305 [=m])
>   Selected by [y]:
>   - BIG_KEYS [=y] && KEYS [=y] && TMPFS [=y]
>   Selected by [m]:
>   - WIREGUARD [=m] && NETDEVICES [=y] && NET_CORE [=y] && NET [=y] && INET [=y] && (IPV6 [=y] || !IPV6 [=y])
>
> WARNING: unmet direct dependencies detected for CRYPTO_LIB_CHACHA20POLY1305
>   Depends on [m]: CRYPTO [=y] && (CRYPTO_ARCH_HAVE_LIB_CHACHA [=m] || !CRYPTO_ARCH_HAVE_LIB_CHACHA [=m]) && (CRYPTO_ARCH_HAVE_LIB_POLY1305 [=m] || !CRYPTO_ARCH_HAVE_LIB_POLY1305 [=m])
>   Selected by [y]:
>   - BIG_KEYS [=y] && KEYS [=y] && TMPFS [=y]
>   Selected by [m]:
>   - WIREGUARD [=m] && NETDEVICES [=y] && NET_CORE [=y] && NET [=y] && INET [=y] && (IPV6 [=y] || !IPV6 [=y])
> x86_64-linux-gnu-ld: lib/crypto/chacha20poly1305.o: in function `xchacha_init':
> chacha20poly1305.c:(.text+0x12d): undefined reference to `chacha_init_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x13d): undefined reference to `hchacha_block_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x14b): undefined reference to `chacha_init_arch'
> x86_64-linux-gnu-ld: lib/crypto/chacha20poly1305.o: in function `__chacha20poly1305_encrypt':
> chacha20poly1305.c:(.text+0x2ab): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x2bd): undefined reference to `poly1305_init_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x2d6): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x317): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x32d): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x379): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x385): undefined reference to `poly1305_final_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x413): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x434): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: lib/crypto/chacha20poly1305.o: in function `chacha20poly1305_encrypt':
> (.text+0x59d): undefined reference to `chacha_init_arch'
> x86_64-linux-gnu-ld: lib/crypto/chacha20poly1305.o: in function `__chacha20poly1305_decrypt':
> chacha20poly1305.c:(.text+0x847): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x859): undefined reference to `poly1305_init_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x86d): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x8a7): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x8f1): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x8fc): undefined reference to `poly1305_final_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x94f): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x9d9): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x9f9): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: lib/crypto/chacha20poly1305.o: in function `chacha20poly1305_decrypt':
> (.text+0xb78): undefined reference to `chacha_init_arch'
> x86_64-linux-gnu-ld: lib/crypto/chacha20poly1305.o: in function `chacha20poly1305_crypt_sg_inplace':
> chacha20poly1305.c:(.text+0xf16): undefined reference to `chacha_init_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0xf3b): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0xf50): undefined reference to `poly1305_init_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1094): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1155): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x117b): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x11da): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1223): undefined reference to `poly1305_final_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1321): undefined reference to `chacha_crypt_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1401): undefined reference to `poly1305_final_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x14a3): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x14d6): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1507): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x1573): undefined reference to `poly1305_update_arch'
> x86_64-linux-gnu-ld: chacha20poly1305.c:(.text+0x15aa): undefined reference to `poly1305_final_arch'
>
> Caused by commit
>
>   f22998a0de8a ("security/keys: rewrite big_key crypto to use library interface")
>
> I have used the keys tree from next-20200512 for today.
>
> --
> Cheers,
> Stephen Rothwell
