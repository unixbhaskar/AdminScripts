Delivered-To: unixbhaskar@gmail.com
Received: by 2002:a19:8c56:0:0:0:0:0 with SMTP id i22csp1120592lfj;
        Thu, 5 Sep 2019 12:23:16 -0700 (PDT)
X-Google-Smtp-Source: APXvYqxQyin+8i6mZyMlfhR/S2OEZJjANq7NFhhinzcAlKeJKV76cVu1L1oohMmyEr2lVqvF9UIY
X-Received: by 2002:a17:902:aa89:: with SMTP id d9mr5360069plr.281.1567711395968;
        Thu, 05 Sep 2019 12:23:15 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1567711395; cv=none;
        d=google.com; s=arc-20160816;
        b=h7UZ4dLdQ40m0vcm5EPOnqeCCIDdBtF/E2ypbynYZDq7hrbvH4WI4DP6nmU0YBGJgM
         Fycxt0r1voHIaO/DPP1bBL0laYjvL7orJpWmVlxbmuDKqyCivzg+M+nn98cmkFjfA+VM
         PzH61SzYx+bn92xJ947jkpH/8OJ+RbCL73wlEmR2i3NbiTkCmf98AEI5MfOQh9RhKGMM
         bWANi9zRTkCGKURnnk5cSHDaeoAboMnMIlgRpF2jEIZzuUOpjfHbw1BCEtVmrC2JaJ99
         FdPpu1SoBqMrY/gSxUYEGDuWX9xzlUOwa3BMw1NxjIMAsoYiqoA3mio/32bVeOMMcbsD
         ISiQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=list-id:precedence:sender:cc:to:subject:message-id:date:from
         :in-reply-to:references:mime-version:dkim-signature;
        bh=skj/g6oI6dabfQCpUUc6UBPVoF5aAw3D1EkLoYv5aGM=;
        b=bhgSk0007uQUYSyHAkpdJNtOESj3anim/JWDHBlZzQJ1X8Gaed07J0CT0F1i1N6P2s
         +NdVPBlFaUBIYX7bn+9ZLF0cFnr0BGglzHAbMCUAj1jp/74/6pRkXjPERhefDu6XWkcE
         hUU6GuRhiaMmrHMsBsJ9QVs0DcvSCzuNFPnJWeCTYqoyBh5VwfXk5GF27w4ifSao5FUw
         KEefb1J03dXp1ZeY2HPeJP8chd/lWGyZVvE0d3YGLvlmQ0JxipJ0eCrsvujx3LJ5hnQi
         nPiTg7yIe5SmnN4patvnT2UjgieXqAwrEVYY7TBTjDaqcHzhbdXw67gf/ao1+Q4LHnCM
         4gbg==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass header.i=@linux-foundation.org header.s=google header.b=dAeCR5at;
       spf=pass (google.com: best guess record for domain of linux-kernel-owner@vger.kernel.org designates 209.132.180.67 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: from vger.kernel.org (vger.kernel.org. [209.132.180.67])
        by mx.google.com with ESMTP id i62si2941297pli.398.2019.09.05.12.23.00;
        Thu, 05 Sep 2019 12:23:15 -0700 (PDT)
Received-SPF: pass (google.com: best guess record for domain of linux-kernel-owner@vger.kernel.org designates 209.132.180.67 as permitted sender) client-ip=209.132.180.67;
Authentication-Results: mx.google.com;
       dkim=pass header.i=@linux-foundation.org header.s=google header.b=dAeCR5at;
       spf=pass (google.com: best guess record for domain of linux-kernel-owner@vger.kernel.org designates 209.132.180.67 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1732470AbfIEQUg (ORCPT <rfc822;huszaghmatt@gmail.com>
        + 99 others); Thu, 5 Sep 2019 12:20:36 -0400
Received: from mail-lj1-f194.google.com ([209.85.208.194]:42664 "EHLO
        mail-lj1-f194.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1729825AbfIEQUe (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 5 Sep 2019 12:20:34 -0400
Received: by mail-lj1-f194.google.com with SMTP id y23so3124390lje.9
        for <linux-kernel@vger.kernel.org>; Thu, 05 Sep 2019 09:20:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linux-foundation.org; s=google;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=skj/g6oI6dabfQCpUUc6UBPVoF5aAw3D1EkLoYv5aGM=;
        b=dAeCR5atGe5w1X5iRAO1B4+ZEuHNKoKyZ9C5iFeqNWytBiNaQXx25ttFaeOzuire+V
         uAG2P3uQnj0g012k0rh9UsuhLmIHx9D6cpl4Z4xbKJNAVgo2gxcChtkI8ATisZpFuMRQ
         turD2jy3tEjQKnr27iHENSiLzWM20us23E8ps=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=skj/g6oI6dabfQCpUUc6UBPVoF5aAw3D1EkLoYv5aGM=;
        b=o7155bA+nB3I/K10tO5EwhOEWeCvqNTDwc8tRVXNar/1gNdjMI2xpb/80QUoFomLbr
         mBYnXNQ20MDNonBiWqHfW6l65j+k/toz9Wter0Yw99xZtfA6/aJy33vnd6giL+kQa3OW
         +WQyI0jzkcuc9JxZVheGVjJIwl+8dZ5d/7FGdInITeIvuYZWa+pAfObXO+yzOPVOU5u9
         l6dJFSdqwAnsbP4HC7uLjyQ6Y2rfEaTPWx0DpUWpN2fS2j2eLYWEfOQOJmxoi8gtTT11
         vh7oTYFBQO9B8lYHPSFxK67mdVyKELmZFn7/hbbCeUgAKLSasJSrxgY//LQhW2JN0JpY
         R2OA==
X-Gm-Message-State: APjAAAWHtAcDqwTbE0J92yvpoovQT+eHZilTcMYGFP0X3toIVKWbRiOV
        ssZSYEuDaJiloZB9v7oFR3UnI9ma+a8=
X-Received: by 2002:a2e:90c6:: with SMTP id o6mr2726366ljg.144.1567700432856;
        Thu, 05 Sep 2019 09:20:32 -0700 (PDT)
Received: from mail-lj1-f176.google.com (mail-lj1-f176.google.com. [209.85.208.176])
        by smtp.gmail.com with ESMTPSA id p22sm456936ljp.69.2019.09.05.09.20.31
        for <linux-kernel@vger.kernel.org>
        (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
        Thu, 05 Sep 2019 09:20:32 -0700 (PDT)
Received: by mail-lj1-f176.google.com with SMTP id y23so2806938ljn.5
        for <linux-kernel@vger.kernel.org>; Thu, 05 Sep 2019 09:20:31 -0700 (PDT)
X-Received: by 2002:a2e:814d:: with SMTP id t13mr2767373ljg.72.1567700431469;
 Thu, 05 Sep 2019 09:20:31 -0700 (PDT)
MIME-Version: 1.0
References: <20190904181740.GA19688@gmail.com>
In-Reply-To: <20190904181740.GA19688@gmail.com>
From:   Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu, 5 Sep 2019 09:20:15 -0700
X-Gmail-Original-Message-ID: <CAHk-=wi2VOPoweqnDhxXKJ9fcLQzkV1oEDjteV=z-C7KXrpomg@mail.gmail.com>
Message-ID: <CAHk-=wi2VOPoweqnDhxXKJ9fcLQzkV1oEDjteV=z-C7KXrpomg@mail.gmail.com>
Subject: Re: [GIT PULL] compiler-attributes for v5.3-rc8
To:     Miguel Ojeda <miguel.ojeda.sandonis@gmail.com>
Cc:     Nick Desaulniers <ndesaulniers@google.com>,
        Will Deacon <will@kernel.org>,
        Josh Poimboeuf <jpoimboe@redhat.com>,
        "Naveen N. Rao" <naveen.n.rao@linux.vnet.ibm.com>,
        "David S. Miller" <davem@davemloft.net>,
        Paul Burton <paul.burton@mips.com>,
        Sedat Dilek <sedat.dilek@gmail.com>,
        Linux List Kernel Mailing <linux-kernel@vger.kernel.org>
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, Sep 4, 2019 at 11:18 AM Miguel Ojeda
<miguel.ojeda.sandonis@gmail.com> wrote:
>
> I was going to send this for 5.4 since it is not that trivial, but since
> you are doing an -rc8, and it fixes an oops, please consider pulling it.

I looked at this, and while it seems safe, I end up worrying.

Macro stringification isn't entirely obvious, and an unquoted string
could become corrupted if the stringification ends up not happening
immediately.

It does seem safe just because we do

  #define __section(S)   __attribute__((__section__(#S)))

but I had to go _check_ that we do, because it wouldn't have been safe
if there had been another level of macro expansion, because then the
argument in turn could have been expanded before it was stringified.

So sometimes you actually _want_ to pass in a string to be
stringified, because it's safer. I realize it then gets string-quoted,
but this has worked for gcc. Even if I suspect nobody really _thought_
about it.

So I'm not unhappy about the patch, but it's the kind of thing I'd
really prefer not to do at this stage.

Particularly since it seems to do other things too than just fix
double quoting. As far as I can tell, it doesn't just fix double
string quoting, it changes a lot of singly-quoted strings to use the
macro and unquotes them, ie

  - __attribute__((__section__(".arch.info.init"))) = {   \
  + __section(.arch.info.init) = {        \

doesn't actually "fix" anything that I can see, it just uses the simpler form.

               Linus
