Delivered-To: unixbhaskar@gmail.com
Received: by 2002:a19:8c56:0:0:0:0:0 with SMTP id i22csp5918556lfj;
        Tue, 10 Sep 2019 06:31:36 -0700 (PDT)
X-Google-Smtp-Source: APXvYqwU4uRLzBmW0t3N7+qkBBXbd9bRpdadFyqoNRgdeHXLMBob//WWxSdFSnIv2MMTEV4bxszr
X-Received: by 2002:a19:c6d5:: with SMTP id w204mr19652501lff.53.1568122296786;
        Tue, 10 Sep 2019 06:31:36 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1568122296; cv=none;
        d=google.com; s=arc-20160816;
        b=bE5FaR8Iy+l6//Y30lZR28HiUW+dXTwLG5pCr0ttKF+h9sZ9gIkLBcsqBkSvKomVw2
         PNXfufb3pLm2sLAl7BIL7Jq6ESiL/cyIz2gQDGyZCsI01JbEelJ/aS8ZuXPNbLVQVi6j
         K+B7zmAs+cPW1xsbSzppF5hlrkvMgRznmGJKLBgtBEahdEryAbToUDPYUNfkbMxDJG6r
         F/Z3c9xkUetUfoQ6BW0jE3/gaJLHjdkVml4kpjudTw09HPzcfNWKdaGmK4dRhNxDXMvf
         Bt1I9fPZBTi1NbzUMxkZ+RSJdZB/IdEBvn7yb4uveKhGs04pyNW3SY2jIJUpn2f6Iqk/
         U4vw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=subject:mime-version:user-agent:content-transfer-encoding:date:cc
         :to:from:message-id:dkim-signature:delivered-to:delivered-to
         :reply-to:list-id:list-subscribe:list-unsubscribe:list-help
         :list-post:precedence:mailing-list;
        bh=AqgMPTkXBXauq0+N3rGflIsFJ0lTa2l0vHL6NbgS5jo=;
        b=nOGXAB/gf4ltnJ3ZQPOh0u5XOGP1EdJSmyiHUrtj6G6s2l/Qm0XAI/6bZyDCybN6zq
         Q4wjs2W6ZlClAIBLtri/VB4LR2mjzMpzb/CaJbH/9SQ7/UYsquf3nPEriDej8xuLXFQc
         gsBz4kAOtiVsma5wPFMZz8AWzzc8xKbqoATuOeZEFtbVzWjZB7n76dW/HswhL2FcZbjd
         pmC5Py4pxRsnQuBArrvYeAZASwu0E6pynZ5sXDVO6pQC6b/Qwx7qBUBVl2S1hnMj8S2Y
         zQeqb9HaSW+A8gA/5Ez/pc6yYL/KnNkMlMBdTuRgRieetinKjK9llbCLdTs4WReI8rnz
         +HgA==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=fail header.i=@neuling.org header.s=201811 header.b=afV9jy3e;
       spf=pass (google.com: domain of oss-security-return-25476-unixbhaskar=gmail.com@lists.openwall.com designates 195.42.179.200 as permitted sender) smtp.mailfrom="oss-security-return-25476-unixbhaskar=gmail.com@lists.openwall.com"
Return-Path: <oss-security-return-25476-unixbhaskar=gmail.com@lists.openwall.com>
Received: from mother.openwall.net (mother.openwall.net. [195.42.179.200])
        by mx.google.com with SMTP id b11si19493641lji.9.2019.09.10.06.31.36
        for <unixbhaskar@gmail.com>;
        Tue, 10 Sep 2019 06:31:36 -0700 (PDT)
Received-SPF: pass (google.com: domain of oss-security-return-25476-unixbhaskar=gmail.com@lists.openwall.com designates 195.42.179.200 as permitted sender) client-ip=195.42.179.200;
Authentication-Results: mx.google.com;
       dkim=fail header.i=@neuling.org header.s=201811 header.b=afV9jy3e;
       spf=pass (google.com: domain of oss-security-return-25476-unixbhaskar=gmail.com@lists.openwall.com designates 195.42.179.200 as permitted sender) smtp.mailfrom="oss-security-return-25476-unixbhaskar=gmail.com@lists.openwall.com"
Received: (qmail 23996 invoked by uid 550); 10 Sep 2019 13:30:35 -0000
Mailing-List: contact oss-security-help@lists.openwall.com; run by ezmlm
Precedence: bulk
List-Post: <mailto:oss-security@lists.openwall.com>
List-Help: <mailto:oss-security-help@lists.openwall.com>
List-Unsubscribe: <mailto:oss-security-unsubscribe@lists.openwall.com>
List-Subscribe: <mailto:oss-security-subscribe@lists.openwall.com>
List-ID: <oss-security.lists.openwall.com>
Reply-To: oss-security@lists.openwall.com
Delivered-To: mailing list oss-security@lists.openwall.com
Delivered-To: moderator for oss-security@lists.openwall.com
Received: (qmail 15721 invoked from network); 10 Sep 2019 13:17:03 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=neuling.org;
	s=201811; t=1568121409;
	bh=8YpvriWgZotmerko0J+/vGDj0I0pWRFk35pz5gDDI3E=;
	h=Subject:From:To:Cc:Date:From;
	b=afV9jy3e43LDgZZ6cCx9zYoP1i33CBwatneHIcRpDM/dYSvl+PlNywbzT+32oG8bn
	 fEMIvS/EcUUFmz95slyme9PkgMYgwoPxm0MXKvlhgOpBJTLx8yJ+fD9kBATXOj0sLi
	 nG6HuBAKzF/cRbGWpr+PY+ZZjgLNPMuG903ctQ4DgFMuPgXxDt1fq1bFFHmpCcU6RY
	 kg0D3PZkrvxrSW/O7PyFz9OOIHTq218qDKrHhGyJxJFRkeGORToHoddoe+bLFs1/eP
	 MVgPofN8mI0/qQ2RmkZQupFHsoohFs5gTiHM6Y7yW3C1MGAvBppA731Z70wSer0/Xn
	 4tyf33YQYzK8w==
Message-ID: <856d6efa0e9b4dd39030e7372a17e3dba2db2aef.camel@neuling.org>
From: Michael Neuling <mikey@neuling.org>
To: oss-security <oss-security@lists.openwall.com>
Cc: Michael Ellerman <michael@ellerman.id.au>,
 linuxppc-dev@lists.ozlabs.org,  linux-kernel@vger.kernel.org,
 Linuxppc-users <linuxppc-users@lists.ozlabs.org>,  Gustavo Romero
 <gromero@linux.vnet.ibm.com>
Date: Tue, 10 Sep 2019 23:16:48 +1000
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
User-Agent: Evolution 3.32.4 (3.32.4-1.fc30) 
MIME-Version: 1.0
Subject: [oss-security] CVE-2019-15030: Linux kernel: powerpc: data leak with FP/VMX 
 triggerable by unavailable exception in transaction

The Linux kernel for powerpc since v4.12 has a bug in it's TM handling wher=
e any
user can read the FP/VMX registers of a difference user's process. Users of=
 TM +
FP/VMX can also experience corruption of their FP/VMX state.

To trigger the bug, a process starts a transaction and reads a FP/VMX regis=
ter.
This transaction can then fail which causes a rollback to the checkpointed
state. Due to the kernel taking an FP/VMX unavaliable exception inside a
transaction and the kernel's incorrect handling of this, the checkpointed s=
tate
can be set to the FP/VMX registers of another process. This checkpointed st=
ate
can then be read by the process hence leaking data from one process to anot=
her.

The trigger for this bug is an FP/VMX unavailable exception inside a
transaction, hence the process needs FP/VMX off when starting the transacti=
on.
FP/VMX availability is under the control of the kernel and is transparent t=
o the
user, hence the user has to retry the transaction many times to trigger thi=
s
bug.=20

All 64-bit machines where TM is present are affected. This includes all POW=
ER8
variants and POWER9 VMs under KVM or LPARs under PowerVM. POWER9 bare metal
doesn't support TM and hence is not affected.

The bug was introduced in commit:
  f48e91e87e67 ("powerpc/tm: Fix FP and VMX register corruption")
Which was originally merged in v4.12

The upstream fix is here:
  https://git.kernel.org/torvalds/c/8205d5d98ef7f155de211f5e2eb6ca03d95a5a6=
0

The fix can be verified by running the tm-poison from the kernel selftests.=
 This
test is in a patch here:
https://patchwork.ozlabs.org/patch/1157467/
which should eventually end up here:
https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/too=
ls/testing/selftests/powerpc/tm/tm-poison.c

cheers
Mikey





