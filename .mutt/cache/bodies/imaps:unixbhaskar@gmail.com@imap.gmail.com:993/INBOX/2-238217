Delivered-To: unixbhaskar@gmail.com
Received: by 2002:a19:f20e:0:0:0:0:0 with SMTP id q14csp1037615lfh;
        Sun, 10 May 2020 21:45:19 -0700 (PDT)
X-Google-Smtp-Source: APiQypK2SkKGVw8FN8zSvf5ntEbv/e1Is6fE+F0f5zigPQRVs6oQr2SWYsHYaiwJXRaFAc3Mj70I
X-Received: by 2002:a17:906:4bc9:: with SMTP id x9mr11466339ejv.27.1589172319017;
        Sun, 10 May 2020 21:45:19 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1589172319; cv=none;
        d=google.com; s=arc-20160816;
        b=UZZlvWojxcxd13VE3/fbMuqKpRMGqGhhB42YrbUgiP+zma5xYw90CtolXV7BP4Q8w/
         7ryF/UL2cJDWd0jJ4U50NVXkanq1g6xsQmrXpoZK1FvYXjnq5HKLKAUBrx+6wLDbbXiQ
         KvSE4dRT0Lo7g8CBGGRJZ/vsO4W9RXte00T8o3BSCMnYPaI37XMd6iP+pZuZXO47bYb6
         x3mMozlqVq7AqtNMwWD1ZDlA57r/rPRdJU3msrhUszRkuby2ZdA9eHJ3iwFqVczWuc1D
         +nPJW+Zfks4v2HmF+k8pNrkhyEQ7mEjqhfB9zoI9tGEj1Yz8BsDCsdRGNKJ/wnKa2ljH
         akGw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=list-id:precedence:sender:content-disposition:mime-version
         :message-id:subject:cc:to:from:date;
        bh=B6YSmlThvGQojqQ0bJkLnanfJAYqkckkfvzR90S3b0M=;
        b=Op7Elf4y/cg1eXCT1yUzFw9bYWgqmcOdCVeeCIxqScQ5kf98uT0b11hCTjOgLIFs54
         LVzIEdR0MfGZARdzW/2zjN1ly3YLDY5zpfUfMe5J+Rx+bnA7NORLEiLntZQgVegRlUe/
         Tei5/jDHk0hg3pbjlX70jGtZjk4lv8/7EY16Xq7PWWQwdvIQAhBS4JIs12lG77fgg1Zc
         w6eLMQes42NirlJbxbRsjNd95m/jVoGzW1IXlMcgkYPW9laYij6KBoyrQDvg2b0tKrsi
         MqcfSnzAMUCrcQwToWPaeTqNDdoeq3vt2GZqc+51D8jzMPPIqkITUQhCLS5IbKM4FhBz
         JX3g==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: domain of linux-kernel-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Return-Path: <linux-kernel-owner@vger.kernel.org>
Received: from vger.kernel.org (vger.kernel.org. [23.128.96.18])
        by mx.google.com with ESMTP id p1si5256545ejw.313.2020.05.10.21.44.44;
        Sun, 10 May 2020 21:45:19 -0700 (PDT)
Received-SPF: pass (google.com: domain of linux-kernel-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) client-ip=23.128.96.18;
Authentication-Results: mx.google.com;
       spf=pass (google.com: domain of linux-kernel-owner@vger.kernel.org designates 23.128.96.18 as permitted sender) smtp.mailfrom=linux-kernel-owner@vger.kernel.org
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726287AbgEKEnf (ORCPT <rfc822;leducqui.kstn@gmail.com>
        + 99 others); Mon, 11 May 2020 00:43:35 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:33048 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-FAIL-OK-FAIL)
        by vger.kernel.org with ESMTP id S1725790AbgEKEnf (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 11 May 2020 00:43:35 -0400
Received: from ZenIV.linux.org.uk (zeniv.linux.org.uk [IPv6:2002:c35c:fd02::1])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id CBC6AC061A0C;
        Sun, 10 May 2020 21:43:34 -0700 (PDT)
Received: from viro by ZenIV.linux.org.uk with local (Exim 4.92.3 #3 (Red Hat Linux))
        id 1jY0Ho-005jBz-CV; Mon, 11 May 2020 04:43:28 +0000
Date:   Mon, 11 May 2020 05:43:28 +0100
From:   Al Viro <viro@zeniv.linux.org.uk>
To:     netdev@vger.kernel.org
Cc:     davem@davemloft.net, viro@zeniv.linux.org.uk,
        linux-kernel@vger.kernel.org
Subject: [RFC][PATCHES] uaccess-related stuff in net/*
Message-ID: <20200511044328.GP23230@ZenIV.linux.org.uk>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

	Assorted uaccess-related work in net/*.  First, there's
getting rid of compat_alloc_user_space() mess in MCAST_...
[gs]etsockopt() - no need to play with copying to/from temporary
object on userland stack, etc., when ->compat_[sg]etsockopt()
instances in question can easly do everything without that.
That's the first 13 patches.  Then there's a trivial bit in
net/batman-adv (completely unrelated to everything else) and
finally getting the atm compat ioctls into simpler shape.

	Please, review and comment.  Individual patches in followups,
the entire branch (on top of current net/master) is in
git://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs.git #uaccess.net

Shortlog:
Al Viro (19):
      lift compat definitions of mcast [sg]etsockopt requests into net/compat.h
      compat_ip{,v6}_setsockopt(): enumerate MCAST_... options explicitly
      ip*_mc_gsfget(): lift copyout of struct group_filter into callers
      get rid of compat_mc_getsockopt()
      set_mcast_msfilter(): take the guts of setsockopt(MCAST_MSFILTER) into a helper
      ipv4: do compat setsockopt for MCAST_MSFILTER directly
      ip6_mc_msfilter(): pass the address list separately
      ipv6: do compat setsockopt for MCAST_MSFILTER directly
      ipv[46]: do compat setsockopt for MCAST_{JOIN,LEAVE}_GROUP directly
      ipv4: take handling of group_source_req options into a helper
      ipv6: take handling of group_source_req options into a helper
      handle the group_source_req options directly
      get rid of compat_mc_setsockopt()
      batadv_socket_read(): get rid of pointless access_ok()
      atm: separate ATM_GETNAMES handling from the rest of atm_dev_ioctl()
      atm: move copyin from atm_getnames() into the caller
      atm: switch do_atm_iobuf() to direct use of atm_getnames()
      atm: lift copyin from atm_dev_ioctl()
      atm: switch do_atmif_sioc() to direct use of atm_dev_ioctl()
Diffstat:
 include/linux/igmp.h         |   2 +-
 include/net/compat.h         |  29 +++-
 include/net/ipv6.h           |   5 +-
 net/atm/ioctl.c              |  96 +++++++------
 net/atm/resources.c          | 108 +++++---------
 net/atm/resources.h          |   5 +-
 net/batman-adv/icmp_socket.c |   3 -
 net/compat.c                 | 194 -------------------------
 net/ipv4/igmp.c              |  18 +--
 net/ipv4/ip_sockglue.c       | 329 ++++++++++++++++++++++++++++++++-----------
 net/ipv6/ipv6_sockglue.c     | 233 ++++++++++++++++++++++++------
 net/ipv6/mcast.c             |  17 +--
 12 files changed, 567 insertions(+), 472 deletions(-)
